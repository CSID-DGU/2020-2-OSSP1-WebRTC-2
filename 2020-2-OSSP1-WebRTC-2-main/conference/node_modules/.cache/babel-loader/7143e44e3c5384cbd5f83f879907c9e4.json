{"ast":null,"code":"import _slicedToArray from\"/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";// https://www.freecodecamp.org/news/building-a-modern-chat-application-with-react-js-558896622194/\nimport React,{useState,useEffect,useRef}from'react';import DragDrop from'./dragDrop';var Chat=function Chat(props){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),message=_useState2[0],setMessage=_useState2[1];var _useState3=useState({uid:0}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),imageZoom=_useState6[0],setImageZoom=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),selectedImage=_useState8[0],setSelectedImage=_useState8[1];var scrollToBottom=function scrollToBottom(){var chat=document.getElementById(\"chatList\");chat.scrollTop=chat.scrollHeight;};useEffect(function(){scrollToBottom();setUser({uid:props.user.uid});},[props]);var sendMessage=function sendMessage(msg){props.sendMessage(msg);scrollToBottom();};var handleSubmit=function handleSubmit(event){if(message==='')return;event.preventDefault();sendMessage({type:'text',message:{id:user.uid,sender:{uid:user.uid},data:{text:message}}});setMessage('');};var handleChange=function handleChange(event){setMessage(event.target.value);};var renderMessage=function renderMessage(userType,data){console.log('===========',data);var message=data.message;var msgDiv=data.type==='text'&&/*#__PURE__*/_jsxs(\"div\",{className:\"msg\",children:[/*#__PURE__*/_jsx(\"p\",{children:message.sender.uid}),/*#__PURE__*/_jsxs(\"div\",{className:\"message\",children:[\" \",message.data.text]})]})||/*#__PURE__*/_jsxs(\"div\",{className:\"msg\",children:[/*#__PURE__*/_jsx(\"p\",{children:message.sender.uid}),/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){setImageZoom(true);setSelectedImage(message.data);},className:\"message\",style:{width:200,// height: 100\ncursor:'pointer'},src:message.data})]});return/*#__PURE__*/_jsx(\"li\",{className:userType,children:msgDiv});};var showEnlargedImage=function showEnlargedImage(data){return/*#__PURE__*/_jsx(\"img\",{src:data,style:{backgroundColor:'black',position:'relative',zIndex:100,display:'block',cursor:'pointer',marginLeft:'auto',marginRight:'auto',padding:20,borderRadius:20},onClick:function onClick(){return setImageZoom(false);}});};return/*#__PURE__*/_jsxs(\"div\",{children:[imageZoom&&showEnlargedImage(selectedImage),/*#__PURE__*/_jsxs(\"div\",{className:\"chatWindow\",style:{zIndex:10,position:'absolute',right:5,top:190,bottom:140,width:350// height: 650,\n},children:[/*#__PURE__*/_jsx(\"ul\",{className:\"chat\",id:\"chatList\",children:props.messages.map(function(data){return/*#__PURE__*/_jsx(\"div\",{children:user.uid===data.message.sender.uid?renderMessage('self',data):renderMessage('other',data)},data.id);})}),/*#__PURE__*/_jsx(DragDrop,{className:\"chatInputWrapper\",sendFiles:function sendFiles(files){var reader=new FileReader();reader.onload=function(e){//https://blog.mozilla.org/webrtc/large-data-channel-messages/\n//https://lgrahl.de/articles/demystifying-webrtc-dc-size-limit.html\nvar maximumMessageSize=262118;//65535 <=== 64KiB // 16384 <=== 16KiB to be safe\nif(e.target.result.length<=maximumMessageSize)sendMessage({type:'image',message:{id:user.uid,sender:{uid:user.uid},data:e.target.result}});else alert('Message exceeds Maximum Message Size!');};reader.readAsDataURL(files[0]);},children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsx(\"input\",{className:\"textarea input\",type:\"text\",placeholder:\"Enter your message...\",onChange:handleChange,value:message})})})})]})]});};export default Chat;","map":{"version":3,"sources":["/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/src/Components/Cam/Chat.js"],"names":["React","useState","useEffect","useRef","DragDrop","Chat","props","message","setMessage","uid","user","setUser","imageZoom","setImageZoom","selectedImage","setSelectedImage","scrollToBottom","chat","document","getElementById","scrollTop","scrollHeight","sendMessage","msg","handleSubmit","event","preventDefault","type","id","sender","data","text","handleChange","target","value","renderMessage","userType","console","log","msgDiv","width","cursor","showEnlargedImage","backgroundColor","position","zIndex","display","marginLeft","marginRight","padding","borderRadius","right","top","bottom","messages","map","files","reader","FileReader","onload","e","maximumMessageSize","result","length","alert","readAsDataURL"],"mappings":"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","sourcesContent":["// https://www.freecodecamp.org/news/building-a-modern-chat-application-with-react-js-558896622194/\n\nimport React, { useState, useEffect, useRef } from 'react'\nimport DragDrop from './dragDrop'\n\nconst Chat = props => {\n  const [message, setMessage] = useState('')\n  const [user, setUser] = useState({ uid: 0, })\n  const [imageZoom, setImageZoom] = useState(false)\n  const [selectedImage, setSelectedImage] = useState('')\n\n  const scrollToBottom = () => {\n    const chat = document.getElementById(\"chatList\");\n    chat.scrollTop = chat.scrollHeight\n  }\n\n  useEffect(() => {\n    scrollToBottom()\n    setUser({ uid: props.user.uid, })\n  }, [props])\n\n  const sendMessage = (msg) => {\n    props.sendMessage(msg);\n    scrollToBottom()\n  }\n\n  const handleSubmit = event => {\n    if (message === '') return\n    event.preventDefault();\n    sendMessage({type:'text', message: { id: user.uid, sender: { uid: user.uid, }, data: { text: message } }})\n    setMessage('')\n  };\n\n  const handleChange = event => {\n    setMessage(event.target.value)\n  }\n\n  const renderMessage = (userType, data) => {\n    console.log('===========', data)\n    const message = data.message\n\n    const msgDiv = data.type === 'text' && (\n      <div className=\"msg\">\n        <p>{message.sender.uid}</p>\n        <div className=\"message\"> {message.data.text}</div>\n      </div>\n    ) || (\n      <div className=\"msg\">\n        <p>{message.sender.uid}</p>\n        <img\n          onClick={() => {\n            setImageZoom(true)\n            setSelectedImage(message.data)\n          }}\n          className=\"message\"\n          style={{\n            width: 200,\n            // height: 100\n            cursor: 'pointer',\n          }}\n          src={message.data} />\n      </div>\n    )\n\n    return (<li className={userType} >{ msgDiv }</li>)\n\n  }\n\n  const showEnlargedImage = (data) => {\n    return (<img\n      src={data}\n      style={{\n        backgroundColor: 'black',\n        position: 'relative',\n        zIndex: 100,\n        display: 'block',\n        cursor: 'pointer',\n        marginLeft: 'auto',\n        marginRight: 'auto',\n        padding: 20,\n        borderRadius: 20,\n      }}\n      onClick={() => setImageZoom(false)}\n    />)\n  }\n\n  return (\n    <div>\n      {imageZoom && showEnlargedImage(selectedImage)}\n\n      <div className=\"chatWindow\" style={{\n        zIndex: 10,\n        position: 'absolute',\n        right: 5,\n        top: 190,\n        bottom: 140,\n        width: 350,\n        // height: 650,\n    }}>\n        <ul className=\"chat\" id=\"chatList\">\n          {props.messages.map(data => (\n            <div key={data.id}>\n              {user.uid === data.message.sender.uid ? renderMessage('self', data) : (renderMessage('other', data))}\n            </div>\n          ))}\n        </ul>\n        <DragDrop\n          className=\"chatInputWrapper\"\n          sendFiles={(files) => {\n            const reader = new FileReader()\n            reader.onload = (e) => {\n              //https://blog.mozilla.org/webrtc/large-data-channel-messages/\n              //https://lgrahl.de/articles/demystifying-webrtc-dc-size-limit.html\n              const maximumMessageSize = 262118 //65535 <=== 64KiB // 16384 <=== 16KiB to be safe\n              if (e.target.result.length <= maximumMessageSize)\n                sendMessage({ type: 'image', message: { id: user.uid, sender: { uid: user.uid, }, data: e.target.result } })\n              else\n                alert('Message exceeds Maximum Message Size!')\n            }\n\n            reader.readAsDataURL(files[0])\n          }}\n        >\n          <div>\n            <form onSubmit={handleSubmit}>\n              <input\n                className=\"textarea input\"\n                type=\"text\"\n                placeholder=\"Enter your message...\"\n                onChange={handleChange}\n                value={message}\n              />\n            </form>\n          </div>\n        </DragDrop>\n      </div>\n      </div>\n    )\n}\n\nexport default Chat"]},"metadata":{},"sourceType":"module"}