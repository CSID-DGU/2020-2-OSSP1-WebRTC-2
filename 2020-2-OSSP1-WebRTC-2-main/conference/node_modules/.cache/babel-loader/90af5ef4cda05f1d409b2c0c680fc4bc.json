{"ast":null,"code":"import _classCallCheck from\"/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{Component}from'react';import io from'socket.io-client';//import './App.css';\nvar Cam=/*#__PURE__*/function(_Component){_inherits(Cam,_Component);var _super=_createSuper(Cam);function Cam(props){var _this;_classCallCheck(this,Cam);_this=_super.call(this,props);_this.componentDidMount=function(){_this.socket=io(// 'https://a21bc378.ngrok.io/webrtcPeer',\n'/webrtcPeer',{path:'/webrtc',query:{}});_this.socket.on('connection-success',function(success){console.log(success);});_this.socket.on('offerOrAnswer',function(sdp){_this.textref.value=JSON.stringify(sdp);_this.pc.setRemoteDescription(new RTCSessionDescription(sdp));});_this.socket.on('candidate',function(candidate){//this.candidate = [...this.candidate, candidate]\n_this.pc.addIceCandidate(new RTCIceCandidate(candidate));});//const pc_config = null\nvar pc_config={\"iceServers\":[// {\n//     urls : 'stun:[STUN-IP]:[PORT]',\n//     'credentials':'[YOR CREDENTIALS]',\n//     'username': '[USERNAME]'\n// }\n{urls:'stun:stun.l.goggle.com:19302'}]};_this.pc=new RTCPeerConnection(pc_config);_this.pc.onicecandidate=function(e){if(e.candidate){_this.sendToPeer('candidate',e.candidate);}};_this.pc.oniceconnectionstatechange=function(e){console.log(e);};_this.pc.onaddstream=function(e){_this.remoteVideoref.current.srcObject=e.stream;};var success=function success(stream){window.localStream=stream;_this.localVideoref.current.srcObject=stream;_this.pc.addStream(stream);};var failure=function failure(e){console.log('getUserMedia Error: ',e);};var constraints={// audio: true,\nvideo:true,// video : {\n//   width: 1280,\n//   height: 720\n// },\n// video: {\n//   width: { min: 1280 },\n// }\noptions:{mirror:true}};navigator.mediaDevices.getUserMedia(constraints).then(success).catch(failure);};_this.sendToPeer=function(messageType,payload){_this.socket.emit(messageType,{socketID:_this.socket.id,payload:payload});};_this.createOffer=function(){console.log('Offer');_this.pc.createOffer({offerToReceiveVideo:1}).then(function(sdp){//console.log(JSON.stringify(sdp))\n_this.pc.setLocalDescription(sdp);_this.sendToPeer('offerOrAnswer',sdp);});};_this.createAnswer=function(){console.log('Answer');_this.pc.createAnswer({offerToReceiveVideo:1}).then(function(sdp){//console.log(JSON.stringify(sdp))\n_this.pc.setLocalDescription(sdp);_this.sendToPeer('offerOrAnswer',sdp);});};_this.setRemoteDescription=function(){var desc=JSON.parse(_this.textref.value);_this.pc.setRemoteDescription(new RTCSessionDescription(desc));};_this.addCandidate=function(){// const candidate = JSON.parse(this.textref.value)\n// console.log('Adding candidate: ', candidate)\n// this.pc.addIceCandidate(new RTCIceCandidate(candidate))\n_this.candidates.forEach(function(candidate){console.log(JSON.stringify(candidate));_this.pc.addIceCandidate(new RTCIceCandidate(candidate));// candidate -> this.candidate\n});};_this.localVideoref=/*#__PURE__*/React.createRef();_this.remoteVideoref=/*#__PURE__*/React.createRef();_this.socket=null;_this.candidates=[];return _this;}_createClass(Cam,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"video\",{style:{width:240,height:240,margin:5,backgroundColor:'black'},ref:this.localVideoref,autoPlay:true}),/*#__PURE__*/_jsx(\"video\",{style:{width:240,height:240,margin:5,backgroundColor:'black'},ref:this.remoteVideoref,autoPlay:true}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{onClick:this.createOffer,children:\"Offer\"}),/*#__PURE__*/_jsx(\"button\",{onClick:this.createAnswer,children:\"Answer\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"textarea\",{ref:function ref(_ref){_this2.textref=_ref;}}),/*#__PURE__*/_jsx(\"br\",{})]});}}]);return Cam;}(Component);export default Cam;","map":{"version":3,"sources":["/Users/eunyoung/OSSP/2020-2-OSSP1-WebRTC-2-main/conference/src/Components/Cam/Cam.js"],"names":["React","Component","io","Cam","props","componentDidMount","socket","path","query","on","success","console","log","sdp","textref","value","JSON","stringify","pc","setRemoteDescription","RTCSessionDescription","candidate","addIceCandidate","RTCIceCandidate","pc_config","urls","RTCPeerConnection","onicecandidate","e","sendToPeer","oniceconnectionstatechange","onaddstream","remoteVideoref","current","srcObject","stream","window","localStream","localVideoref","addStream","failure","constraints","video","options","mirror","navigator","mediaDevices","getUserMedia","then","catch","messageType","payload","emit","socketID","id","createOffer","offerToReceiveVideo","setLocalDescription","createAnswer","desc","parse","addCandidate","candidates","forEach","createRef","width","height","margin","backgroundColor","ref"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport io from 'socket.io-client'\n//import './App.css';\n\nclass Cam extends Component{\n  constructor(props){\n    super(props)\n\n    this.localVideoref = React.createRef()\n    this.remoteVideoref = React.createRef()\n\n    this.socket = null\n    this.candidates = []\n\n  }\n  componentDidMount=()=>{\n    \n    this.socket = io(\n      // 'https://a21bc378.ngrok.io/webrtcPeer',\n      '/webrtcPeer',\n      {\n        path: '/webrtc',\n        query: {}\n      }\n    )\n\n    this.socket.on('connection-success', success=>{\n      console.log(success)\n    })\n\n    this.socket.on('offerOrAnswer', (sdp)=>{\n      this.textref.value = JSON.stringify(sdp)\n\n      this.pc.setRemoteDescription(new RTCSessionDescription(sdp))\n    })\n\n    this.socket.on('candidate', (candidate) => {\n      //this.candidate = [...this.candidate, candidate]\n      this.pc.addIceCandidate(new RTCIceCandidate(candidate))\n    })\n\n    //const pc_config = null\n\n    const pc_config = {\n      \"iceServers\":[\n          // {\n          //     urls : 'stun:[STUN-IP]:[PORT]',\n          //     'credentials':'[YOR CREDENTIALS]',\n          //     'username': '[USERNAME]'\n          // }\n          {\n              urls : 'stun:stun.l.goggle.com:19302'\n          }\n      ]\n    }\n\n    this.pc = new RTCPeerConnection(pc_config)\n\n    this.pc.onicecandidate = (e) => {\n      if (e.candidate){\n        this.sendToPeer('candidate', e.candidate)\n      } \n    }\n\n    this.pc.oniceconnectionstatechange = (e) => {\n      console.log(e)\n    }\n\n    this.pc.onaddstream = (e) => {\n      this.remoteVideoref.current.srcObject = e.stream\n    }\n\n    const success = (stream) => {\n      window.localStream = stream\n      this.localVideoref.current.srcObject = stream\n      this.pc.addStream(stream)\n    }\n\n    const failure = (e) => {\n      console.log('getUserMedia Error: ', e)\n    }\n\n    const constraints = {\n      // audio: true,\n      video: true,\n      // video : {\n      //   width: 1280,\n      //   height: 720\n      // },\n      // video: {\n      //   width: { min: 1280 },\n      // }\n      options: {\n        mirror: true,\n      }\n    }\n\n    navigator.mediaDevices.getUserMedia(constraints)\n    .then(success)\n    .catch(failure)\n\n  }\n\n  sendToPeer = (messageType, payload) => {\n    this.socket.emit(messageType, {\n      socketID: this.socket.id,\n      payload\n    })\n  }\n\n  createOffer = () => {\n    console.log('Offer')\n    this.pc.createOffer({offerToReceiveVideo: 1})\n    .then(sdp => {\n      //console.log(JSON.stringify(sdp))\n      this.pc.setLocalDescription(sdp)\n\n      this.sendToPeer('offerOrAnswer',sdp)\n    })\n  }\n\n  createAnswer = () => {\n    console.log('Answer')\n    this.pc.createAnswer({offerToReceiveVideo: 1})\n    .then(sdp => {\n      //console.log(JSON.stringify(sdp))\n      this.pc.setLocalDescription(sdp)\n\n      this.sendToPeer('offerOrAnswer', sdp)\n    })\n  }\n\n  setRemoteDescription = () => {\n    const desc = JSON.parse(this.textref.value)\n    this.pc.setRemoteDescription(new RTCSessionDescription(desc))\n  }\n\n  addCandidate = () => {\n    // const candidate = JSON.parse(this.textref.value)\n    // console.log('Adding candidate: ', candidate)\n\n    // this.pc.addIceCandidate(new RTCIceCandidate(candidate))\n\n    this.candidates.forEach(candidate => {\n      console.log(JSON.stringify(candidate))\n      this.pc.addIceCandidate(new RTCIceCandidate(candidate))\n      // candidate -> this.candidate\n    });\n  }\n\n  render(){\n\n    return(\n      <div>\n        <video\n          style={{\n            width: 240, height: 240,\n            margin: 5, backgroundColor: 'black'\n          }\n          }\n          ref={this.localVideoref} \n          autoPlay></video>\n        <video\n          style={{\n            width: 240, height: 240,\n            margin: 5, backgroundColor: 'black'\n          }\n          }\n          ref={this.remoteVideoref} \n          autoPlay></video>\n        <br/>\n        <button onClick = {this.createOffer}>Offer</button>\n        <button onClick = {this.createAnswer}>Answer</button>\n        <br/>\n        <textarea ref={ref=>{this.textref = ref}}/>\n        <br/>\n        {/*<button onClick = {this.setRemoteDescription}>Set Remote Desc</button>\n        <button onClick = {this.addCandidate}>Add Candidate</button>*/}\n      </div>\n      \n    );\n  }\n}\n\nexport default Cam;\n"]},"metadata":{},"sourceType":"module"}